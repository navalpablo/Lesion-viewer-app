{% extends "base.html" %}

{% block title %}View Subject {{ subject.subject_id }}{% endblock %}

{% block content %}
    <h1>Subject Viewer: {{ subject.subject_id }}</h1>
    <form id="annotationForm">
        {% for lesion_id, slices in subject.lesions.items() %}
            <div class="lesion-container mb-4">
                <h3>Lesion: {{ lesion_id }}</h3>
                <input type="range" min="0" max="{{ slices|length - 1 }}" value="{{ slices|length // 2 }}" class="form-range slice-range" id="sliceRange_{{ lesion_id }}">
                <div class="text-center mt-3">
                    <img id="sliceImage_{{ lesion_id }}" src="{{ url_for('serve_slice', filename=slices[slices|length // 2]) }}" 
                         alt="Slice Image" class="img-fluid"
                         data-lesion-id="{{ lesion_id }}"
                         data-subject-id="{{ subject.subject_id }}">
                </div>
                <div class="mt-2">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="annotation_{{ lesion_id }}" id="reader_1_{{ lesion_id }}" value="Reader_1">
                        <label class="form-check-label" for="reader_1_{{ lesion_id }}">Reader_1</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="annotation_{{ lesion_id }}" id="reader_2_{{ lesion_id }}" value="Reader_2">
                        <label class="form-check-label" for="reader_2_{{ lesion_id }}">Reader_2</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="annotation_{{ lesion_id }}" id="no_rim_{{ lesion_id }}" value="No_rim">
                        <label class="form-check-label" for="no_rim_{{ lesion_id }}">No_rim</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="annotation_{{ lesion_id }}" id="review_{{ lesion_id }}" value="Review">
                        <label class="form-check-label" for="review_{{ lesion_id }}">Review</label>
                    </div>
                </div>
            </div>
        {% endfor %}
        <button type="submit" class="btn btn-primary mt-4">Save All Annotations</button>
    </form>
{% endblock %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/viewer.js') }}"></script>
{% endblock %}